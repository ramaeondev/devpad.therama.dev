<div class="user-search fixed inset-0 md:absolute md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 flex items-center justify-center z-50">
  <!-- Backdrop -->
  <button 
    class="absolute inset-0 bg-black/80 md:hidden" 
    (click)="onClose()" 
    (keydown.escape)="onClose()"
    aria-label="Close search"
    type="button"
    class:pointer-events-auto="false"
    [style.pointer-events]="'auto'"></button>

  <!-- Modal -->
  <div class="relative bg-black border-2 border-retro-green w-full md:w-96 max-h-96 md:max-h-full p-4 flex flex-col">
    <!-- Header -->
    <div class="flex items-center justify-between mb-4 pb-3 border-b border-retro-green/30">
      <h2 class="font-mono text-lg font-bold text-retro-green">FIND USER</h2>
      <button (click)="onClose()" class="p-1 text-retro-green hover:text-retro-green/80" aria-label="Close search">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <!-- Search Input -->
    <div class="mb-4">
      <input
        [(ngModel)]="searchQuery"
        (input)="onSearch()"
        placeholder="SEARCH BY EMAIL..."
        class="w-full bg-gray-900 border-2 border-retro-green text-retro-green font-mono text-sm p-2 placeholder-gray-500 focus:outline-none focus:border-retro-green/80"
      />
    </div>

    <!-- Search Results -->
    <div class="flex-1 overflow-y-auto space-y-1">
      @if (searching()) {
      <div class="flex items-center justify-center py-8">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-retro-green"></div>
      </div>
      } @else if (results().length === 0 && searchQuery) {
      <div class="p-4 text-center text-gray-400">
        <p class="font-mono text-sm">NO USERS FOUND</p>
      </div>
      } @else if (results().length === 0) {
      <div class="p-4 text-center text-gray-400">
        <p class="font-mono text-sm">ENTER A NAME TO SEARCH</p>
      </div>
      } @else {
      @for (user of results(); track user.id) {
      <button
        (click)="onSelectUser(user)"
        class="user-result w-full text-left px-3 py-2 flex items-center gap-3 hover:bg-gray-800 border border-retro-green/20 hover:border-retro-green transition-colors"
      >
        <div class="relative flex-shrink-0">
          <div class="w-10 h-10 rounded bg-retro-green/20 border border-retro-green flex items-center justify-center">
            @if (user.avatar_url) {
            <img [src]="user.avatar_url" alt="{{ user.first_name }}" class="w-full h-full rounded object-cover" />
            } @else {
            <span class="text-retro-green font-mono text-sm font-bold">
              {{ (user.first_name || 'U')[0] | uppercase }}
            </span>
            }
          </div>
          @if (user.is_online) {
          <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-retro-green rounded-full border border-black"></div>
          }
        </div>
        <div class="flex-1">
          <h3 class="font-mono text-sm text-retro-green font-bold">
            {{ user.email }}
          </h3>
          <p class="text-xs text-gray-400">
            {{ user.first_name }} {{ user.last_name }}
          </p>
          <p class="text-xs text-gray-400">
            @if (user.is_online) {
            <span class="text-retro-green">‚óè ONLINE</span>
            } @else {
            <span>OFFLINE</span>
            }
          </p>
        </div>
      </button>
      }
      }
    </div>
  </div>
</div>
